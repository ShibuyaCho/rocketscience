<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Black Sheep Cultivation</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .popup {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .popup-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 600px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .quantity-input {
      width: 60px;
    }
  </style>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script type="text/javascript">
    (function() {
      emailjs.init("4Nay5tc4PcpTV9k4Q");
    })();
  </script>
</head>
<body>
  <header>
    <div class="container">
      <h1>Black Sheep Cultivation</h1>
      <p>A Passion Project - Exotic Cannabis Strains of Exemplary Profiles</p>
    </div>
  </header>

  <main>
    <div id="cart-icon" onclick="toggleCart(event)">
      ðŸ›’ <span id="cart-count">0</span>
    </div>
    <div id="cart-details" style="display: none;">
      <h2>Your Cart</h2>
      <ul id="cart"></ul>
      <div id="cart-subtotal"></div>
      <button onclick="placeOrder()">Place an Order</button>
      <div class="farm-buttons">
        <button onclick="location.href='index.html'">Back to Main Menu</button>
      </div>
    </div>

    <section class="farm-details">
      <div class="container">
        <h2>Popular Strains</h2>
        <p>Available strains rotate frequently. Contact us for current offerings!</p>
        <ul class="strain-list">
          <li class="strain-item" onclick="addToCart('Han Solo in Platinum', '35%', '1600')">
            <div><strong>Strain: Han Solo in Platinum <br>Lineage: Han Solo Burger x Platinum Siv OG<br>THC: 35% <br>Price: $1,600/lb</strong></div>
          </li>
          <li class="strain-item" onclick="addToCart('Animal Tsunami', '31%', '1600')">
            <div><strong>Strain: Animal Tsunami <br>Lineage: Caramel Tsunami x Animal Cookies <br>THC: 31%<br>Price: $1,600/lb</strong></div>
          </li>
          <li class="strain-item" onclick="addToCart('Ben & Gary\'s', '27%', '1600')">
            <div><strong>Strain: Ben & Gary's <br>Lineage: Ben & Berries x Gary's Poppins <br>THC: 27%<br>Price: $1,600/lb</strong></div>
          </li>
          <li class="strain-item" onclick="addToCart('Peach Goblin', '31%', '1600')">
            <div><strong>Strain: Peach Goblin <br>Lineage: Peach Goblin x Gelato 41 <br>THC: 31%<br>Price: $1,600/lb</strong></div>
          </li>
          <li class="strain-item" onclick="addToCart('Butterscotch Breath', '26%', '1600')">
            <div><strong>Strain: Butterscotch Breath <br>Lineage: Butter Scotch x Mendo Breath F2 <br>THC: 26%<br>Price: $1,600/lb</strong></div>
          </li>
          <li class="strain-item" onclick="addToCart('Tibetan Fingertrap', '28%', '1600')">
            <div><strong>Strain: Tibetan Fingertrap <br>Lineage: Gary Satan x Oh La La <br>THC: 28%<br>Price: $1,600/lb</strong></div>
          </li>
        </ul>
      </div>
    </section>
  </main>

  <div id="orderFormPopup" class="popup">
    <div class="popup-content">
      <span class="close" onclick="closeOrderForm()">&times;</span>
      <h2>Confirm Your Order</h2>
      <div id="orderItemsContainer"></div>
      <textarea id="orderNotes" placeholder="Add any additional notes for your order here" rows="4" cols="50"></textarea>
      <input type="email" id="customerEmail" placeholder="Enter your email address" required>
      <button onclick="submitOrder()">Confirm Order</button>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 Rocket Science. All rights reserved.</p>
    </div>
  </footer>
  
<script>
  let cart = [];
  let quarterPoundEnabled = false;

  document.addEventListener('keydown', function(event) {
    // Check for Ctrl + Alt + Q
    if (event.ctrlKey && event.altKey && event.key === 'q') {
      quarterPoundEnabled = !quarterPoundEnabled;
      alert(quarterPoundEnabled ? '1/4 lb functionality enabled' : '1/4 lb functionality disabled');
      updateCart(); // Refresh the cart display
    }
  });

  function toggleCart(event) {
    event.stopPropagation(); // Prevent the document click event from immediately closing the cart
    const cartDetails = document.getElementById('cart-details');
    cartDetails.style.display = cartDetails.style.display === 'none' ? 'block' : 'none';
  }

  function updateCart() {
    const cartElement = document.getElementById('cart');
    const cartCount = document.getElementById('cart-count');
    cartElement.innerHTML = '';
    let totalItems = 0;
    let subtotal = 0;
    cart.forEach((item, index) => {
      const li = document.createElement('li');
      const itemSubtotal = item.price * item.quantity;
      li.innerHTML = `
        ${item.strain} - $${item.price}/lb x${item.quantity.toFixed(quarterPoundEnabled ? 2 : 0)}lb
        <br>Subtotal: $${itemSubtotal.toFixed(2)}
        <button onclick="removeFromCart(${index})">Remove</button>
      `;
      cartElement.appendChild(li);
      totalItems += item.quantity;
      subtotal += itemSubtotal;
    });
    cartCount.textContent = totalItems.toFixed(quarterPoundEnabled ? 2 : 0);
    document.getElementById('cart-subtotal').innerHTML = `<strong>Total: $${subtotal.toFixed(2)}</strong>`;
  }

  function addToCart(strain, thc, price) {
    const existingItem = cart.find(item => item.strain === strain);
    if (existingItem) {
      existingItem.quantity += quarterPoundEnabled ? 0.25 : 1;
    } else {
      cart.push({ strain, thc, price: parseFloat(price), quantity: quarterPoundEnabled ? 0.25 : 1 });
    }
    updateCart();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCart();
  }

  function placeOrder() {
    const orderItemsContainer = document.getElementById('orderItemsContainer');
    orderItemsContainer.innerHTML = '';

    cart.forEach((item, index) => {
      const itemDiv = document.createElement('div');
      itemDiv.innerHTML = `
        <p>${item.strain} (THC: ${item.thc}) - $${item.price}/lb</p>
        <input type="number" class="quantity-input" value="${item.quantity}" 
               min="${quarterPoundEnabled ? 0.25 : 1}" 
               step="${quarterPoundEnabled ? 0.25 : 1}" 
               onchange="updateQuantity(${index}, this.value)">
        <span>Subtotal: $${(item.price * item.quantity).toFixed(2)}</span>
      `;
      orderItemsContainer.appendChild(itemDiv);
    });

    const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    const subtotalDiv = document.createElement('div');
    subtotalDiv.innerHTML = `<strong>Total: $${subtotal.toFixed(2)}</strong>`;
    orderItemsContainer.appendChild(subtotalDiv);

    document.getElementById('orderFormPopup').style.display = 'block';
  }

  function updateQuantity(index, newQuantity) {
    const parsedQuantity = parseFloat(newQuantity);
    if (!quarterPoundEnabled && parsedQuantity % 1 !== 0) {
      alert('Only whole pound quantities are allowed.');
      placeOrder(); // Refresh the order form with the original quantity
      return;
    }
    if (quarterPoundEnabled && parsedQuantity % 0.25 !== 0) {
      alert('Only quarter pound increments are allowed.');
      placeOrder(); // Refresh the order form with the original quantity
      return;
    }
    cart[index].quantity = parsedQuantity;
    updateCart();
    placeOrder(); // Refresh the order form
  }

  function closeOrderForm() {
    document.getElementById('orderFormPopup').style.display = 'none';
  }

 function submitOrder() {
    const notes = document.getElementById('orderNotes').value;
    const customerEmail = document.getElementById('customerEmail').value;
        const farmName = document.querySelector('header h1').textContent; 


    if (!customerEmail) {
      alert('Please enter your email address.');
      return;
    }

    let formattedOrderDetails = "Order Details:\n\n";
    
    // Iterate through the cart items to include quantity
    cart.forEach(item => {
      formattedOrderDetails += `${item.strain} (THC: ${item.thc}) - $${item.price}/lb\n`;
      formattedOrderDetails += `Quantity: ${item.quantity.toFixed(quarterPoundEnabled ? 1 : 0)} lb\n`;
      formattedOrderDetails += `Subtotal: $${(item.price * item.quantity).toFixed(2)}\n\n`;
    });

    // Add total
    const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
    formattedOrderDetails += `Total: $${total.toFixed(2)}\n\n`;

    if (notes) {
      formattedOrderDetails += `Additional Notes:\n${notes}\n`;
    }

    const templateParams = {
      from_email: customerEmail,
      message: formattedOrderDetails,
      farm_name: farmName,
      recipient: 'dinofreud@gmail.com'
    };

    console.log('Sending email with params:', templateParams);

        emailjs.send('service_k67bf2e', 'template_1hz0yfr', templateParams)
      .then(function(response) {
        console.log('SUCCESS!', response.status, response.text);
        alert('Order submitted successfully!');
        cart = []; // Clear the cart
        updateCart(); // Update the cart display
        closeOrderForm(); // Close the order form popup
      }, function(error) {
        console.log('FAILED...', error);
        alert('Failed to submit order. Please try again.');
      });
  }

  // Close cart when clicking outside
  document.addEventListener('click', function(event) {
    const cartDetails = document.getElementById('cart-details');
    const cartIcon = document.getElementById('cart-icon');

    // Check if the click is outside the cart and the cart icon
    if (!cartDetails.contains(event.target) && !cartIcon.contains(event.target)) {
      cartDetails.style.display = 'none';
    }
  });

  // Prevent the cart from closing when clicking inside it
  document.getElementById('cart-details').addEventListener('click', function(event) {
    event.stopPropagation();
  });
</script>
</body>
</html>